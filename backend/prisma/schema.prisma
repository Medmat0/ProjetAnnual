// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
// Table pour user 
model User {
  id                        Int              @id @default(autoincrement())
  name                      String
  email                     String           @unique
  password                  String
  role                      Role             @default(USER)
  isActive                  Boolean          @default(true)
  createdAt                 DateTime         @default(now())
  updatedAt                 DateTime         @updatedAt
  passwordResetToken        String?
  passwordResetTokenVerfied Boolean?
  passwordResetTokenExpire  String?
  passwordChangedAt         String?
  emailVerificationToken    String?          @unique
  emailVerified             Boolean          @default(false)
  comments                  Comment[]
  likes                     Like[]
  posts                     Post[]
  programPosts              ProgramPost[]
  profile                   Profile?
  followers                 FollowRelation[] @relation(name: "followed")
  following                 FollowRelation[] @relation(name: "follower")
  followRequestsSent        FollowRequest[] @relation(name: "requester")
  followRequestsReceived    FollowRequest[] @relation(name: "requestee")
  programCollections        ProgramPost[]   @relation(name: "collection")
  notifications             Notification[]  
  friends1                  Friendship[]     @relation(name: "friendshipUser1")
  friends2                  Friendship[]     @relation(name: "friendshipUser2")
  replies                   Reply[]          @relation(name: "UserReplies")


}


model Friendship {
  id          Int  @id @default(autoincrement())
  userId1     Int
  userId2     Int
  user1       User @relation(name: "friendshipUser1", fields: [userId1], references: [id])
  user2       User @relation(name: "friendshipUser2", fields: [userId2], references: [id])

  @@unique([userId1, userId2])
}
model Notification {
  id         Int      @id @default(autoincrement())
  type       String
  message    String
  userId     Int
  createdAt  DateTime @default(now())
  isRead     Boolean  @default(false)
  user       User     @relation(fields: [userId], references: [id])
}


// table pour un post normal
model Post {
  id            Int       @id @unique @default(autoincrement())
  userId        Int
  title         String
  content       String?
  image         String[]
  likesCount    Int       @default(0)
  commentsCount Int       @default(0)
  postedAt      DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  privacy       Privacy   @default(FOLLOWERS)
  comments      Comment[]
  likes         Like[]
  author        User      @relation(fields: [userId], references: [id])
}

// table pour les program post 
model ProgramPost {
  id            Int       @id @unique @default(autoincrement())
  userId        Int
  title         String
  description   String
  code          String
  inputType     String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  privacy       Privacy   @default(FOLLOWERS)
  author        User      @relation(fields: [userId], references: [id])
  collection    User[]    @relation(name: "collection")
}

model FollowRelation {
  id         Int  @id @default(autoincrement())
  followedId Int
  followerId Int
  followed   User @relation(name: "followed", fields: [followedId], references: [id])
  follower   User @relation(name: "follower", fields: [followerId], references: [id])
}

model Profile {
  id      Int     @id @default(autoincrement())
  userId  Int     @unique
  bio     String      @default("Not bio yet.")
  image   String?
  city    String
  website String?
  user    User    @relation(fields: [userId], references: [id])
}

model Like {
  postId Int
  userId Int
  Post   Post @relation(fields: [postId], references: [id])
  User   User @relation(fields: [userId], references: [id])

  @@id([postId, userId])
}

model Comment {
  id     Int   @unique     @default(autoincrement())
  postId Int
  userId Int
  content String
  Post   Post @relation(fields: [postId], references: [id])
  User   User @relation(fields: [userId], references: [id])
  replies  Reply[]  @relation(name : "CommentReplies")
  

}

model Reply {
  id        Int    @id @unique @default(autoincrement())
  commentId Int
  userId    Int
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  comment   Comment @relation(name :"CommentReplies", fields: [commentId], references: [id])
  user      User    @relation(name : "UserReplies" ,fields: [userId], references: [id])
}


model FollowRequest {
  id         Int      @id @default(autoincrement())
  requesterId Int
  requesteeId Int
  status     RequestStatus @default(PENDING)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  requester  User @relation(name: "requester", fields: [requesterId], references: [id])
  requestee  User @relation(name: "requestee", fields: [requesteeId], references: [id])
}

enum RequestStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum Role {
  USER
  ADMIN
}

enum Privacy {
  PUBLIC
  PRIVATE
  FOLLOWERS
}
